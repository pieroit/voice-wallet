<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
        <meta name="format-detection" content="telephone=no">
        <meta name="msapplication-tap-highlight" content="no">
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
        
        <link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
        <link rel="stylesheet" href="css/native-droid/nativedroid2.css">
        <link rel="stylesheet" href="css/font-awesome-4.4.0/css/font-awesome.min.css" />  
        <link rel="stylesheet" href="js/nv.d3/nv.d3.min.css" />
        <link rel="stylesheet" href="js/leaflet/leaflet.css" />
        <link rel="stylesheet" href="css/index.css">    

        
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="js/leaflet/leaflet.js"></script>
        <script type="text/javascript" src="js/d3.min.js"></script>
        <script type="text/javascript" src="js/nv.d3/nv.d3.min.js"></script>
        <script type="text/javascript" src="js/moment.min.js"></script>
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/jquery.mobile-1.4.5.min.js"></script>
        <script type="text/javascript" src="js/i0n.js"></script>
        <script type="text/javascript" src="js/parser.js"></script>
        <script type="text/javascript" src="js/report.js"></script>
        <script type="text/javascript" src="js/database.js"></script>
        <script type="text/javascript" src="js/form.js"></script>
        <script type="text/javascript" src="js/app.js"></script>
        
        <title>Boink</title>
    </head>
    <body>
        
        <!-- home page -->
        <div id="home" data-role="page">
           
            <div data-role="header" data-position="fixed">
                <img id="logo" src="img/logo.png">
                <div id="quote">
                    Don't let making a living prevent you from making a life. - John Wooden
                </div>
            </div>
            
            <div data-role="content">
                <div>
                    <button class="fa fa-microphone" id="speak-green" type="button"></button>
                    <button class="fa fa-microphone" id="speak-red" type="button"></button>        
                </div>
            </div>

            <div data-role="footer" data-position="fixed">
                <div data-role="navbar" id="navmenu">
                    <ul>
                        <li><a class="fa fa-microphone" href="#home"></a></li>
                        <li><a class="fa fa-eye" href="#report"></a></li>
                        <li><a class="fa fa-cog" href="#options"></a></li>
                    </ul>
                </div>
            </div>
            
        </div>
        <!-- end home page -->
        
        
        <!-- form page -->
        <div id="form" data-role="page">
        
            <div data-role="content">
                <div class="fa fa-circle" id="spoken"> recording...</div>
                
                <span class="form-inline">
                    <input id="form-import-polarity" type="hidden" value="1" >
                    <input id="form-import" type="number" placeholder="import" >
                </span>
                <!--<span class="form-inline">-->
                    <!--<select id="form-currency" data-mini="true" >
                        <option value="EUR" selected>&#8364;</option>
                        <option value="DOL">$</option>
                        <option value="YEN">Y</option>
                    </select>-->
                    <fieldset data-role="controlgroup" data-mini="true" data-type="horizontal">
                        <input type="radio" name="form-currency" id="radio-choice-h-2a" value="EUR" checked="checked">
                        <label for="radio-choice-h-2a">&#128;</label>
                        <input type="radio" name="form-currency" id="radio-choice-h-2b" value="USD">
                        <label for="radio-choice-h-2b">$</label>
                    </fieldset>
                <!--</span>-->
                <textarea id="form-description" placeholder="description" ></textarea>
                <input id="form-category" type="text" name="text-basic" placeholder="category" >
                <span class="form-inline">
                    <input id="form-data" type="date" name="text-basic">
                </span>
                <span class="form-inline">
                    <input id="form-data" type="time" name="text-basic">
                </span>
                <div id="form-map"></div>
                <div>
                    <a id="form-button-ok" data-role="button" data-inline="true">Save</a>
                    <a id="form-button-cancel" data-role="button" data-inline="true">Cancel</a>
                    <a id="form-button-delete" data-role="button" data-inline="true">Delete</a>
                </div>
                
            </div>
        </div>
        <!-- end form page -->
        
        
        <!-- report page -->
        <div id="report" data-role="page">
            
            <div id="report-content" data-role="content">
                <div id="plot-container">
                    <table id="report-div"></table>
                    <div id="map-div"></div>
                    <svg id="report-svg"></svg>
                </div>

                <div id="dashboard-controls">

                    <div id="time-span-buttons">
                        <a class="fa fa-chevron-left" id="time-span-button-start" data-role="button" data-inline="true" data-time-span-start="55555555"></a>
                        <span id="report-title">...</span>
                        <a class="fa fa-chevron-right" id="time-span-button-end" data-role="button" data-inline="true" data-time-span-end="66666666"></a>
                    </div>

                    <fieldset data-role="controlgroup" id="type-control">
                        <legend>Report type</legend>
                        <input type="radio" name="radio-type" id="radio-type-list" value="list" checked="checked" />
                        <label class="fa fa-list-ul" for="radio-type-list"></label>

                        <input type="radio" name="radio-type" id="radio-type-pie" value="pie"  />
                        <label class="fa fa-pie-chart" for="radio-type-pie"></label>

                        <input type="radio" name="radio-type" id="radio-type-line" value="line"  />
                        <label class="fa fa-area-chart" for="radio-type-line"></label>

                        <input type="radio" name="radio-type" id="radio-type-map" value="map" />
                        <label class="fa fa-map-o" for="radio-type-map"></label>
                    </fieldset>

                    <fieldset data-role="controlgroup" id="span-control">
                        <legend>Time span</legend>
                        <input type="radio" name="radio-span" id="radio-span-day" value="86400" data-verbal-span="day" checked="checked" />
                        <label for="radio-span-day">Day</label>

                        <input type="radio" name="radio-span" id="radio-span-week" value="604800" data-verbal-span="week" />
                        <label for="radio-span-week">Week</label>

                        <input type="radio" name="radio-span" id="radio-span-month" value="2630000" data-verbal-span="month" />
                        <label for="radio-span-month">Month</label>

                        <input type="radio" name="radio-span" id="radio-span-year" value="31560000" data-verbal-span="year" />
                        <label for="radio-span-year">Year</label>
                    </fieldset>

                    <fieldset data-role="controlgroup" id="valence-control">
                        <legend>Valence</legend>

                        <input type="radio" name="radio-valence" id="radio-valence-expense" value="expense" checked="checked" />
                        <label  class="fa fa-frown-o" for="radio-valence-expense"></label>

                        <input type="radio" name="radio-valence" id="radio-valence-balance" value="balance"  />
                        <label class="fa fa-meh-o" for="radio-valence-balance"></label>

                        <input type="radio" name="radio-valence" id="radio-valence-income" value="income"  />
                        <label class="fa fa-smile-o" for="radio-valence-income"></label>

                    </fieldset>

                    <!-- search
                    <label for="search-control-group">Filter</label>     
                    <input type="text" id="search-control-group" data-wrapper-class="controlgroup-textinput ui-btn">
                    -->
                </div>
            </div>
            
            <div data-role="footer" data-position="fixed">
                <div data-role="navbar" id="navmenu">
                    <ul>
                        <li><a class="fa fa-microphone" href="#home"></a></li>
                        <li><a class="fa fa-eye" href="#report"></a></li>
                        <li><a class="fa fa-cog" href="#options"></a></li>
                    </ul>
                </div>
            </div>
            
        </div>
        <!-- end report page -->
       
        
        <!-- options page -->
        <div id="options" data-role="page">
            
            <div data-role="content">
                <div id="spoken">...</div>
                <h1>Opzioni e credits</h1>
                Qua devo mettere: scelta della lingua, scelta della currency e licenze.                
            </div>
            
            
            <div data-role="footer" data-position="fixed">
                <div data-role="navbar" id="navmenu">
                    <ul>
                        <li><a class="fa fa-microphone" href="#home"></a></li>
                        <li><a class="fa fa-eye" href="#report"></a></li>
                        <li><a class="fa fa-cog" href="#options"></a></li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- end options page -->
        
        <script>
            
            var recognition;
            
            var deviceReadyDeferred = $.Deferred();
            var jqmReadyDeferred = $.Deferred();
            
            if ( !!window.cordova ) {
                console.log('we are on device');
                $.when(deviceReadyDeferred, jqmReadyDeferred).done( appInit );
            } else {
                console.log('we are on desktop');
                // TODO: make HTML5 speech recog work
                var SpeechRecognition = webkitSpeechRecognition;
                $.when(jqmReadyDeferred).done( appInit );
            }
            
            $(document).ready( function () {
                console.log('jQuery is ready');
                jqmReadyDeferred.resolve();
            });
            
            document.addEventListener('deviceReady', onDeviceReady, false);
            function onDeviceReady() {
                console.log('cordova is ready');
                deviceReadyDeferred.resolve();
            }	
            
            function appInit() {
                
                console.log('appInit fired', db);

                recognition = new SpeechRecognition();
                recognition.lang = 'it-IT';
                recognition.onresult = function(event) {
                    console.log('event', event);
                    if (event.results.length > 0) {
                        var voiceInput = event.results[0][0].transcript;
                        
                        // parse command
                        var obj = parseSentence(voiceInput);
                        
                        // give visual feedback
                        console.log(obj);
                        $('#spoken').text(voiceInput);
                        
                        // update form
                        precompileForm(obj);                        
                    }
                };
                console.log('recognition', recognition);

                $('#speak-green').on('click', function(){
                    initForm(1);
                    $.mobile.navigate('#form');
                    recognition.start();                            
                });

                $('#speak-red').on('click', function(){
                    initForm(-1);
                    $.mobile.navigate('#form');
                    recognition.start();                            
                });
                
                initReport();
            }
        </script>
        
    </body>
</html>


